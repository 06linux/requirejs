<!DOCTYPE html>
<html>
<head>
    <title>run.js: Modifier Test</title>
    <script type="text/javascript" src="../../run.js"></script>
    <script type="text/javascript" src="../doh/runner.js"></script>
    <script type="text/javascript" src="../doh/_browserRunner.js"></script>
    <script type="text/javascript">
    
        doh.register(
            "modifier",
            [
		{
		    name: "multiversion",
		    timeout: 5000,
		    runTest: function() {

                        var d = new doh.Deferred();
                        run({
                                baseUrl: "./"
                            }
                        );
                        run.modify({
                            "target": "size"
                        });
                        run({
                                baseUrl: "./"
                            },
                            ["target", "color", "run"],
                            function(target, color, run) {
                                run.ready(function() {
                                    doh.is("small", target.size);
                                    doh.is("green", target.color);
                                    doh.is("target", target.design);
                                    doh.is("target", target.name);
    
                                    setTimeout(function() {
                                        run.modify({
                                            "target": "design"
                                        });
    
                                        setTimeout(function() {
                                            doh.is("small", target.size);
                                            doh.is("green", target.color);
                                            doh.is("funky", target.design);
                                            doh.is("target", target.name);
                                            d.callback(true);
                                        }, 1000);
                                    }, 500);
                                });
                            }
                        );
                        return d;
                    }
                }
            ]
        );
        doh.run();
    </script>
</head>
<body>
    <h1>Modifier Test</h1>
    <p>This page tests a module modifying another module. Both before the module
    is loaded and after.</p>

    <p>First call sequence</p>
    <ul>
        <li id="size1"></li>
        <li id="color1"></li>
        <li id="design1"></li>
        <li id="name1"></li>
   </ul>
    
    <p>Second call sequence</p>
    <ul>
        <li id="size2"></li>
        <li id="color2"></li>
        <li id="design2"></li>
        <li id="name2"></li>
   </ul>
</body>
</html>

